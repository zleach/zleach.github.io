<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Z+M Mortgage Calculator</title>
        <meta name="viewport" content="width=device-width, user-scalable=no" />
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/rangeslider.css">
        <script>
            $( document ).ready(function() {

              const cssClasses = [
                'rangeslider--is-lowest-value',
                'rangeslider--is-highest-value'
              ];
              
              $('input[type=range]')
                .rangeslider({
                  polyfill: false
                })
                .on('input', function() {
                    $('#price').val(accounting.formatMoney(this.value,{
                        precision : 0,
                	}))
                    
                    const fraction = (this.value - this.min) / (this.max - this.min);
                    if (fraction === 0) {
                        this.nextSibling.classList.add(cssClasses[0]);
                    } else if (fraction === 1) {
                        this.nextSibling.classList.add(cssClasses[1]);
                    } else {
                        this.nextSibling.classList.remove(...cssClasses)
                    }
                    
                    calculate();
                });

                $('#price').maskMoney({
                    prefix : "$",
                    precision : 0,
                }).on('keyup keydown change blur',calculate)
                $('#interest').maskMoney({
                    suffix : "%",
                    precision : 1,
                }).on('keyup keydown ',calculate)
                
                var presetPrice = getParameterByName('price')
                if(presetPrice){
                    $('#priceRange').val(presetPrice).change();
                    
                	$('#price').val(accounting.formatMoney(presetPrice,{
                        precision : 0,
                	}));
                }
                
                calculate();
            });
            
            function calculate(){
                var vaLoanAmount = 636000;
                
                
                var re = new RegExp(',', 'g');
                var price = parseInt($('#price').val().replace("$", "").replace(re, ""));
                
                // Diff
                var difference = price-vaLoanAmount;
                if(difference<=0) difference = 0;
                
                $('#difference').text(accounting.formatMoney(difference));

                // DP                
                var downPayment = difference*.25
                $('#downpayment').text(accounting.formatMoney(downPayment));
            
                // Closing Costs
                var closingCost = price*.025
                $('#closingcost').text(accounting.formatMoney(closingCost));

                // Total
                var total = closingCost+downPayment
                $('#total').text(accounting.formatMoney(total));
                
                // Payment
                var apr = parseFloat($('#interest').val().replace("%", ""))/1200;                
                var amt = price-downPayment;
                var term = 30*12;
                
            	var payment = amt*(apr * Math.pow((1 + apr), term))/(Math.pow((1 + apr), term) - 1);
                $('#payment').text(accounting.formatMoney(payment));

            }

            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            
        </script>

    </head>
    <body>
        <div class="container">
            <h3>Zach &amp; Maddie</h3>
            <p class="text-muted">Home Loan Calculator</p>
            <form class="margin-top-lg">
                <div class="form-group form-group-lg">
                    <label for="price" class="margin-bottom-lg">Home Price</label>
                    <input
                        id="priceRange"
                        type="range"
                        min="636000"
                        max="1000000"
                        step="1000"
                        value="650000"
                    >
                    <input type="text" class="form-control text-right number margin-top-lg" id="price" placeholder="$636,000" value="$650,000">
                </div>
                <div class="form-group">
                    <label for="interest">Interest Rate APR%</label>
                    <input type="text"  class="form-control text-right number" id="interest" placeholder="3.75%" value="3.75%">
                </div>
                <hr>
                <dl>
                    <dt>VA Loan Difference</dt>
                    <dd class="text-right number" id="difference"></dd>
                </dl>
                <dl>
                    <dt>Downpayment Needed (25%)</dt>
                    <dd class="text-right number" id="downpayment"></dd>
                </dl>
                <dl>
                    <dt>Closing Costs (2.5%)</dt>
                    <dd class="text-right number" id="closingcost"></dd>
                </dl>
                <dl>
                    <dt>Total Due at Signing</dt>
                    <dd class="text-right number" id="total"></dd>
                </dl>
                <hr>
                <dl>
                    <dt>Monthly Payment</dt>
                    <dd class="text-right number" id="payment"></dd>
                </dl>


            </form>
        </div>        
        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-maskmoney/3.0.2/jquery.maskMoney.min.js"></script>
        <script src="js/vendor/rangeslider.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/accounting.min.js"></script>
        <script src="js/main.js"></script>
    </body>
</html>